@model List<WordVision.ec.Web.Areas.Indicadores.Models.MarcoLogicoAsignadoViewModel>

<table id="logTable" class="table table-striped mt-5" width="100%" cellspacing="0">
    <thead>
        <tr>
            <th>
                Marco Lógico (Indicadores R,P y  A)
            </th>
            <th>
                PA
            </th>
            <th>
                Responsable
            </th>
            <th>
                Poblacion
            </th>
        </tr>
    </thead>
    <tbody>
        @foreach (var item in Model)
        {
            <tr>
                <td>
                    @Html.DisplayFor(modelItem => item.Descripcion)
                </td>
                <td>
                    @if (item.Nuevo)
                    {
                        @Html.CheckBoxFor(modelItem => item.Asignado , new { @class = "mlasignadocheck" , @data_actprod=(item.EsActividad || item.EsProducto) ,@data_marcologicoid=item.MarcoLogico.Id, data_programatecnicoid=item.MarcoLogico.LogFrame.IdProgramaTecnico??0,@onchange="isValidInsert()"})
                    }
                    else
                    {
                        @if (item.Asignado)
                        {
                            <p>X</p>
                        }
                    }
                </td>
                <td>
                    @if (item.Nuevo)
                    {
                        <div class="form-group">
                            <label for="IdResponsable" class="control-label"></label>
                            @Html.DropDownList("IdResponsable", (IEnumerable<SelectListItem>)ViewBag.ResponsablesSelect,"Seleccione un responsable", htmlAttributes: new { @class = "form-control ", @style = "width:100%;", @data_actprod=(item.EsActividad || item.EsProducto),@data_marcologicoid=item.MarcoLogico.Id, data_programatecnicoid=item.MarcoLogico.LogFrame.IdProgramaTecnico??0, @onchange="asisgarResponsablesActividadProducto(this)" })
                            <span for="IdResponsable" class="text-danger"></span>
                        </div>
                    }
                    else
                    {
                        @if (item.Asignado)
                        {
                            <p>@item.Responsable.NombresCompletos</p>
                        }
                    }
                </td>
                <td>
                    @if (item.Nuevo)
                    {
                        <div class="form-group">
                            <label for="poblacion" class="control-label"></label>
                            <input for="poblacion" type="number" class="form-control" data-marcologicoid="@item.MarcoLogico.Id" data-programatecnicoid="@item.MarcoLogico.LogFrame.IdProgramaTecnico" onchange="isValidInsert()"/>
                            <span for="Poblacion" class="text-danger"></span>
                        </div>   
                    }else
                    {
                        @if (item.Asignado)
                        {
                            <p>@item.Poblacion</p>
                        }
                    }
                </td>

            </tr>
        }
    </tbody>
</table>
@if (ViewBag.BotonHabilitado == true)
{
    <div class="form-group justify-content-between group-button-modal">
        <button type="submit" class="btn btn-success d-none" id="btnInsertar" onclick="createRecords()">Guardar</button>
    </div>
}




<script>
    $(document).ready(function () {
        $("#logTable").DataTable();
    });

    function createRecords(){
        var confirmacion = confirm("¿Desea registrar la información?");

        if(!confirmacion) return;
        const marcoLogicoAsignadoViewModel = mappedRecords();
        $.post('@Url.Action("OnPostCreate", "MarcoLogicoAsignado")', {'marcoLogicoAsignado' : marcoLogicoAsignadoViewModel},
            function (result) {
               GetLF();
         });
     }
</script>
